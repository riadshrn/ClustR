% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ClustDeepVar.R
\name{ClustDeepVar}
\alias{ClustDeepVar}
\title{ClustDeepVar: Deep Variable Clustering via Autoencoder Embeddings}
\description{
R6 class for clustering variables using deep autoencoder neural networks.
Each variable is represented by its latent embedding learned by an autoencoder,
then clustered with k-means in the latent space. This allows capturing
non-linear relationships between variables.
}
\details{
\strong{Algorithm (high level):}
\enumerate{
\item Standardize the data matrix \code{X} (observations x variables).
\item Transpose to get \eqn{X^T} (variables x observations).
\item Train an autoencoder on \eqn{X^T} to reconstruct the variables
from their latent representation.
\item Extract the latent codes for each variable (rows of \eqn{X^T}).
\item Cluster these latent codes with k-means.
\item Optionally compute soft cluster memberships and project illustrative
variables into the latent space.
}

\strong{Architecture:}

\deqn{\text{Input} (n\_obs) -> hidden layers -> latent (d) -> hidden layers -> output (n\_obs)}

where each "observation" of the autoencoder is a \strong{variable} from the
original dataset.
}
\section{Premium features}{

\itemize{
\item Configurable depth and width of the autoencoder.
\item Optional dropout and L2 regularisation.
\item Choice of loss: \code{"mse"}, \code{"mae"}, or \code{"huber"}.
\item Soft cluster memberships (probabilities) based on distances in
the latent space.
\item Training history stored + \code{$plot_training()}.
\item 2D and 3D visualisation of embeddings.
\item Projection of illustrative variables (numeric or factor) into
the latent space + helper \code{$nearest_to_illustrative()}.
}
}

\examples{
\dontrun{
set.seed(42)
X <- matrix(rnorm(200 * 15), nrow = 200)
colnames(X) <- paste0("Var", 1:15)

model <- ClustDeepVar$new(
  n_clusters   = 3,
  latent_dim   = 5,
  hidden_layers = c(64, 32),
  epochs       = 50,
  dropout      = 0.1,
  l2_reg       = 1e-4
)

model$fit(X)
model$summary()

# Hard and soft clusters
head(model$clusters)
head(model$soft_membership)

# Project one illustrative numeric variable
illu_emb <- model$project_illustrative(X[, 1])
illu_emb

# 2D visualisation
model$plot_embeddings_2d()
model$plot_training()
}

}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{data}}{Numeric matrix of standardized data (observations x variables).}

\item{\code{n_clusters}}{Integer. Number of clusters.}

\item{\code{latent_dim}}{Integer. Dimension of latent space.}

\item{\code{clusters}}{Integer vector of cluster memberships (one per variable).}

\item{\code{embeddings}}{Numeric matrix of latent embeddings (variables x latent_dim).}

\item{\code{soft_membership}}{Numeric matrix (variables x n_clusters) of soft cluster
probabilities (rows sum to 1).}

\item{\code{cluster_centers}}{Numeric matrix (n_clusters x latent_dim) of centers
in the latent space.}

\item{\code{autoencoder}}{Keras model of the full autoencoder.}

\item{\code{encoder}}{Keras model of the encoder part only.}

\item{\code{reconstruction_error}}{Global mean squared reconstruction error.}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-ClustDeepVar-new}{\code{ClustDeepVar$new()}}
\item \href{#method-ClustDeepVar-fit}{\code{ClustDeepVar$fit()}}
\item \href{#method-ClustDeepVar-predict}{\code{ClustDeepVar$predict()}}
\item \href{#method-ClustDeepVar-predict_new}{\code{ClustDeepVar$predict_new()}}
\item \href{#method-ClustDeepVar-get_clusters}{\code{ClustDeepVar$get_clusters()}}
\item \href{#method-ClustDeepVar-project_illustrative}{\code{ClustDeepVar$project_illustrative()}}
\item \href{#method-ClustDeepVar-nearest_to_illustrative}{\code{ClustDeepVar$nearest_to_illustrative()}}
\item \href{#method-ClustDeepVar-print}{\code{ClustDeepVar$print()}}
\item \href{#method-ClustDeepVar-summary}{\code{ClustDeepVar$summary()}}
\item \href{#method-ClustDeepVar-plot_embeddings_2d}{\code{ClustDeepVar$plot_embeddings_2d()}}
\item \href{#method-ClustDeepVar-plot_embeddings_3d}{\code{ClustDeepVar$plot_embeddings_3d()}}
\item \href{#method-ClustDeepVar-plot_embeddings_3d_ext}{\code{ClustDeepVar$plot_embeddings_3d_ext()}}
\item \href{#method-ClustDeepVar-plot_reconstruction}{\code{ClustDeepVar$plot_reconstruction()}}
\item \href{#method-ClustDeepVar-plot_training}{\code{ClustDeepVar$plot_training()}}
\item \href{#method-ClustDeepVar-clone}{\code{ClustDeepVar$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-new"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-new}{}}}
\subsection{Method \code{new()}}{
Initialize a new ClustDeepVar object.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$new(
  n_clusters = 3L,
  latent_dim = NULL,
  hidden_layers = c(64L, 32L),
  activation = "relu",
  epochs = 100L,
  batch_size = 32L,
  learning_rate = 0.001,
  dropout = 0,
  l2_reg = 0,
  loss = c("mse", "mae", "huber"),
  validation_split = 0.2,
  temperature = 1,
  seed = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{n_clusters}}{Integer. Number of clusters.}

\item{\code{latent_dim}}{Integer. Dimension of latent space. If NULL,
defaults to \code{2 * n_clusters}.}

\item{\code{hidden_layers}}{Integer vector. Sizes of hidden layers in the
encoder (decoder is symmetric).}

\item{\code{activation}}{Character. Activation function for hidden layers.}

\item{\code{epochs}}{Integer. Max number of epochs for training.}

\item{\code{batch_size}}{Integer. Batch size used for training.}

\item{\code{learning_rate}}{Numeric. Learning rate of Adam optimizer.}

\item{\code{dropout}}{Numeric in \link{0,1}. Dropout rate applied after each
hidden layer (0 = no dropout).}

\item{\code{l2_reg}}{Numeric. L2 regularisation factor (0 = no regularisation).}

\item{\code{loss}}{Character. One of "mse", "mae", "huber".}

\item{\code{validation_split}}{Numeric in (0,1). Fraction of variables
used for validation during training.}

\item{\code{temperature}}{Numeric > 0. Temperature used when converting
distances to soft cluster probabilities (higher = softer).}

\item{\code{seed}}{Optional integer. Random seed used for reproducibility
(Keras + R).}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-fit"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-fit}{}}}
\subsection{Method \code{fit()}}{
Fit the deep variable clustering model on a data matrix.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$fit(X, verbose = 1)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{X}}{Numeric matrix or data.frame (observations x variables).}

\item{\code{verbose}}{Integer (0, 1 or 2). Verbosity of Keras training.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Invisibly returns \code{self}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-predict"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-predict}{}}}
\subsection{Method \code{predict()}}{
Predict hard cluster membership for new variables.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$predict(X_new, mode = c("flex", "strict"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{X_new}}{Numeric matrix or data.frame (observations x NEW variables).}

\item{\code{mode}}{Character. Scaling mode:
\itemize{
\item "strict" = reuse mean and sd from training data per variable.
\item "flex"   = global mean/sd on the fitted data.
}}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Integer vector of cluster assignments for the new variables.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-predict_new"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-predict_new}{}}}
\subsection{Method \code{predict_new()}}{
Predict embeddings, hard clusters and soft probabilities for new variables.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$predict_new(X_new, mode = c("flex", "strict"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{X_new}}{Numeric matrix or data.frame (observations x NEW variables).}

\item{\code{mode}}{Scaling mode, see \code{$predict()}.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
List with elements \code{embeddings}, \code{clusters},
and \code{soft_membership}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-get_clusters"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-get_clusters}{}}}
\subsection{Method \code{get_clusters()}}{
Get cluster assignments (compatibility with VariableClustering)
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$get_clusters()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
Named integer vector of cluster assignments
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-project_illustrative"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-project_illustrative}{}}}
\subsection{Method \code{project_illustrative()}}{
Project illustrative variables into the latent space.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$project_illustrative(X_illu, labels = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{X_illu}}{Either:
\itemize{
\item a numeric or factor vector (single illustrative variable), or
\item a matrix / data.frame with several illustrative variables in columns.
}}

\item{\code{labels}}{Optional character vector of labels to use as row names
in the returned matrix. If \code{NULL}, uses column names (for
matrices/data.frames) or:
\itemize{
\item "Illustrative" for a single numeric vector,
\item the factor levels for factor variables.
}}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Numeric matrix of size (n_illu_levels x latent_dim), where
rows correspond to illustrative variables (or their levels) and
columns to latent dimensions.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-nearest_to_illustrative"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-nearest_to_illustrative}{}}}
\subsection{Method \code{nearest_to_illustrative()}}{
Find variables closest to a given illustrative embedding (e.g. one level).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$nearest_to_illustrative(illustrative_embeddings, level, k = 5L)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{illustrative_embeddings}}{Matrix returned by \code{$project_illustrative()}.}

\item{\code{level}}{Row name in \code{illustrative_embeddings} to use as target.}

\item{\code{k}}{Integer. Number of closest variables to return.}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Data frame with columns \code{Variable} and \code{Distance}.
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-print"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-print}{}}}
\subsection{Method \code{print()}}{
Print a compact summary of the model.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$print()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-summary"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-summary}{}}}
\subsection{Method \code{summary()}}{
Detailed textual summary of clustering results.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$summary()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-plot_embeddings_2d"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-plot_embeddings_2d}{}}}
\subsection{Method \code{plot_embeddings_2d()}}{
Plot variable embeddings in 2D latent space.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$plot_embeddings_2d(
  dims = c(1L, 2L),
  use_pca = FALSE,
  new_embeddings = NULL,
  new_clusters = NULL,
  new_labels = NULL,
  illustrative_embeddings = NULL,
  illustrative_labels = NULL,
  alpha_new = 0.9
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{dims}}{Integer vector of length 2 indicating latent dimensions.}

\item{\code{new_embeddings}}{Optional matrix of new embeddings to overlay.}

\item{\code{new_clusters}}{Optional integer vector of cluster assignments
for new embeddings.}

\item{\code{new_labels}}{Optional labels for new embeddings.}

\item{\code{illustrative_embeddings}}{Optional matrix of illustrative
embeddings to overlay.}

\item{\code{illustrative_labels}}{Optional labels for illustrative embeddings.}

\item{\code{alpha_new}}{Numeric alpha transparency for new variables.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-plot_embeddings_3d"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-plot_embeddings_3d}{}}}
\subsection{Method \code{plot_embeddings_3d()}}{
Plot variable embeddings in 3D latent space (requires rgl).


Plot variable embeddings in 3D latent space (requires rgl).
Automatically applies PCA if latent_dim > 3.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$plot_embeddings_3d(
  dims = c(1L, 2L, 3L),
  use_pca = TRUE,
  new_embeddings = NULL,
  new_clusters = NULL,
  new_labels = NULL,
  illustrative_embeddings = NULL,
  illustrative_labels = NULL,
  alpha_new = 0.9
)}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-plot_embeddings_3d_ext"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-plot_embeddings_3d_ext}{}}}
\subsection{Method \code{plot_embeddings_3d_ext()}}{
Backwards-compatible alias for \code{$plot_embeddings_3d()}.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$plot_embeddings_3d_ext(...)}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-plot_reconstruction"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-plot_reconstruction}{}}}
\subsection{Method \code{plot_reconstruction()}}{
Plot reconstruction error per variable.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$plot_reconstruction()}\if{html}{\out{</div>}}
}

}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-plot_training"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-plot_training}{}}}
\subsection{Method \code{plot_training()}}{
Plot training curves (loss and optionally validation loss).
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$plot_training(metric = c("loss", "val_loss", "mae", "val_mae"))}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{metric}}{Character, one of "loss", "val_loss", "mae", "val_mae"
if available in the training history.}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-ClustDeepVar-clone"></a>}}
\if{latex}{\out{\hypertarget{method-ClustDeepVar-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{ClustDeepVar$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
